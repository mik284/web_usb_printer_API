<!DOCTYPE html>
<html lang="en">
<head>    
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>Web USB Printer</title>
</head>
<body>
    <div class="container">
        <img class="thermal-printer" src="assets/images/usb-printer.png" alt="Web USB Printer">
        <h1>Web USB Printer</h1>
        <div>
            <button id="connect">Connect to USB Printer</button>
            <button id="print" disabled>Print Test Page</button>
        </div>
        <p id="status">Not connected</p>
    </div>

    <script>
        let device;

        const connectButton = document.getElementById('connect');
        const printButton = document.getElementById('print');
         const statusElement = document.getElementById('status');

        connectButton.addEventListener('click', async () => {
            try {
                device = await navigator.usb.requestDevice({
                    filters: [{ classCode: 0x07 }] // USB printer class
                });
                await device.open();
                await device.selectConfiguration(1);
                await device.claimInterface(0);

                console.log('Connected to printer:', device);
                printButton.disabled = false;
            } catch (error) {
                console.error('Error connecting to printer:', error);
                statusElement.textContent = 'Error connecting to printer';
                statusElement.style.color = 'red';
            }
        });

        printButton.addEventListener('click', async () => {
            if (!device) {
                console.error('No printer connected');
                return;
            }

            try {
                const encoder = new TextEncoder();
                const data = encoder.encode('Hello, Web USB Printer!\n');

                await device.transferOut(1, data);
                console.log('Print data sent successfully');
                statusElement.textContent = 'Print data sent successfully';
                statusElement.style.color = 'green';
            } catch (error) {
                console.error('Error sending print data:', error);
                statusElement.textContent = 'Error sending print data';
                statusElement.style.color = 'red';
            }
        });
    </script>
</body>

</html>